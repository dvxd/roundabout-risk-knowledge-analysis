# Risk knowledge training and visualization: RounD dataset

* Analysis of the flow and exit patterns in RounD roundabouts.
* Training of a model to estimate the probability of a vehicle to exit the roundabout based on its kinematics.
* Definition of a global metric of risk for a roundabout, based on TTC and the exit probability of vehicles.
* Estimation of the relationship between the variation of TTC in an area and the amount of associated risk.


# Files description

  * To use the provided code, `ROUND_PATH = "../dataset/round/data/"` should be replaced with the actual path to your local copy of the rounD dataset in the [tools/consts.py](tools/consts.py) file.

The provided TTC analysis code is a tool to assess the variation of TTC in roundabouts of the rounD dataset, as well as risk, and investigate on correlation between these two units.
The provided files should be run in the following order:

  * [parse_exits.py](parse_exits.py): Parses the recordings of a given location ID to extract training data to train a model to assess roundabout exit probability of vehicles.
  * [parse.py](parse.py): Parses the recordings of a given location ID to augment the tracks with TTC data.


Once the data has been generated, it can be analyzed and visualized with the following scripts:

  * [analysis_exits.py](analysis_exits.py): Trains a model to assess exit probability of a vehicle from the roundabout of given location ID.
  * [analysis.py](analysis.py): Uses the TTC-augmented tracks generated by the [parse.py](parse.py) file to study correlation between TTC variation and risk.


# Quickstart

```console
$ python3 parse_flows.py --location=[INSERT YOUR LOCATION HERE]
This will generate the flow (entry/exit) statistics, as a prerequisite for the generation of exit probability model training data.
Result JSON files will be generated in the flow_parse/ directory.

$ python3 parse_exits.py --location=[INSERT YOUR LOCATION HERE]
This will generate the training data for roundabout exit probability model training.
Result JSON files will be generated in the exit_parse/ directory.

$ python3 parse.py --probability_weighting --location=[INSERT YOUR LOCATION HERE]
The probability_weighting option is important, as it will allow the parse.py script to use the exit probability model to generate probability-weighted risk.
Result JSON files will be generated in the ttc_parse/ directory.

$ python3 analysis_exits.py --location=[INSERT YOUR LOCATION HERE]
Will show visualization of the training data for the roundabout exit probability model.
Will train the model and give its accuracy.

$ python3 analysis.py --location=[INSERT YOUR LOCATION HERE] --ttclimit=7.5 --cvtime=60.0
Will show correlation analysis between TTC CV and risk.
--ttclimit is the maximum TTC value in seconds that will be considered for computing the CV.
--cvtime is time in terms of TTC data values that will be used to compute the CV. (e.g. compute the CV of TTC values over the last 60 seconds of TTC values).
```
